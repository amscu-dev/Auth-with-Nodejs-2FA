openapi: 3.1.0
info:
  title: API for Password, Passkey, Magic Link, and OIDC Authentication
  description: >
    API for user registration and authentication using multiple methods:
    username/password with capability of 2fa, passkey (WebAuthn), magic link, and OIDC providers (Google, GitHub, etc.).
  contact:
    name: Marinescu Alexandru
    email: amarinescu.dev@gmail.com
  license:
    name: Apache License 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0
  version: 1.0.0
servers:
  - url: https://accounts.authportal.com/api/v1
    description: Production Server
paths:
  /auth/register:
    post:
      tags: [Email & Password Auth]
      summary: Register a new user
      description: This endpoint allows a new user to create an account using their email and password. After registration, the user must verify their email to complete the registration process successfully.
      requestBody:
        required: true
        description: Request body for user registration.
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserRegistrationRequestBody"
      responses:
        "201":
          description: Registration successful. A verification email has been sent, the user must confirm their email to complete the signup process.
          headers:
            X-Request-Id:
              $ref: "#/components/headers/XRequestId"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RegistrationSuccessReponse"
        "400":
          description: Bad Request — validation failed or user already exists.
          headers:
            X-Request-Id:
              $ref: "#/components/headers/XRequestId"
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: "#/components/schemas/EmailAlreadyExistsError"
                  - $ref: "#/components/schemas/InvalidRequestBodyValidationError"
  /auth/login:
    post:
      tags: [Email & Password Auth]
      summary: Authenticate a user with email and password
      description: >
        This endpoint allows an existing user to log in using their email and password.
        Upon successful authentication, an access token (and optionally a refresh token) is returned.
        If the user has two-factor authentication enabled, additional steps may be required to complete the login process.
      requestBody:
        required: true
        description: Credentials for user login
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserLoginRequestBody"
      responses:
        "200":
          description: >
            Authentication response. Depending on the user's status, one of the following outcomes is returned:
            1. Email not verified — user must confirm their email to proceed.
            2. Two-factor authentication required — user must complete MFA to finalize login.
            3. Authentication successful — user credentials are valid, and access/refresh tokens are provided.
          headers:
            X-Request-Id:
              $ref: "#/components/headers/XRequestId"
            Set-Cookie:
              $ref: "#/components/headers/AuthenticationCookies"
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: "#/components/schemas/LoginEmailVerificationPendingResponse"
                  - $ref: "#/components/schemas/MFAPendingResponse"
                  - $ref: "#/components/schemas/LoginSuccessResponse"
        "404":
          description: >
            User not found — no account exists with the provided email address. 
            The client should prompt the user to register before attempting login.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserNotFoundError"
        "400":
          description: >
            Invalid credentials — the provided email or password is incorrect. 
            The client should notify the user and allow them to retry authentication.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/InvalidCredentialsError"
  /auth/email/verify:
    post:
      tags: [Email & Password Auth]
      summary: Authenticate a user with email and password
      description: >
        Verifies a user's email address using a verification token sent via email.
        Upon successful verification, the user's account is marked as confirmed, allowing them to complete the login process or other protected actions.
      requestBody:
        required: true
        description: Verify a user's email address
        content:
          application/json:
            schema:
              type: object
              required:
                - code
              properties:
                code:
                  type: string
                  example: n3910310n013912310sa
      responses:
        "200":
          description: >
            Email verification successful. The user's email address has been confirmed, enabling them to complete the login process and access protected resources.
          headers:
            X-Request-Id:
              $ref: "#/components/headers/XRequestId"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EmailConfirmedSuccessResponse"
        "404":
          description: >
            Verification failed, the provided verification code was not found.
            This may happen if the code is invalid or never issued. The user should request a new verification code.
          headers:
            X-Request-Id:
              $ref: "#/components/headers/XRequestId"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/VerificationCodeNotFoundError"
        "400":
          description: >
            Verification failed due to an invalid verification code state:
            1. The code has expired — the user must request a new verification code.
            2. The code has already been consumed — the user must request a new verification code.
          headers:
            X-Request-Id:
              $ref: "#/components/headers/XRequestId"
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: "#/components/schemas/VerificationCodeExpiredError"
                  - $ref: "#/components/schemas/VerificationCodeConsumedError"
  /auth/password/forgot:
    post:
      tags: [Email & Password Auth]
      summary: Request a password reset for a user account
      description: >
        Initiates the password reset process for a user by submitting their email address. 
        If the user has two-factor authentication (MFA) enabled, an MFA verification step will be required before sending the password reset instructions. Otherwise, a password reset email will be sent directly.
      requestBody:
        required: true
        description: Email address of the user requesting a password reset
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ForgotPasswordRequestBody"
      responses:
        "200":
          description: >
            Password reset request processed successfully. Depending on the user's account configuration:
            1. MFA pending — if the user has two-factor authentication enabled, an MFA verification step is required before sending the reset email.
            2. Reset email sent — if MFA is not enabled, a password reset email has been sent with instructions to reset the password.
          headers:
            X-Request-Id:
              $ref: "#/components/headers/XRequestId"
            Set-Cookie:
              $ref: "#/components/headers/MFATokenCookie"
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: "#/components/schemas/MFAPendingResponse"
                  - $ref: "#/components/schemas/ForgotPasswordSuccessResponse"
        "404":
          description: >
            User not found — no account exists for the provided email address. Ensure the email is correct and try again.
          headers:
            X-Request-Id:
              $ref: "#/components/headers/XRequestId"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserNotFoundError"
        "503":
          description: >
            Email service unavailable — the system could not send the password reset email due to a temporary email service failure. Retry the request later.
          headers:
            X-Request-Id:
              $ref: "#/components/headers/XRequestId"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EmailServiceError"
  /auth/password/reset:
    patch:
      tags: [Email & Password Auth]
      summary: Complete the password reset process
      description: >
        Completes the password reset process for a user account using a valid verification code.  
        The request must include the verification code (typically received via email) and the new password.  
        Upon successful verification, the user's password is updated, existing authentication cookies are cleared,  
        and the user is advised to log in again. If the password reset was not initiated by the user, they are encouraged  
        to contact support immediately. The operation also records contextual information such as IP address and user agent  
        for security auditing purposes.
      requestBody:
        required: true
        description: x
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ResetPasswordRequestBody"
      responses:
        "200":
          description: >
            Password reset completed successfully.  
            All existing authentication cookies are invalidated to ensure previous sessions are closed.  
            The user should proceed to log in with the new password.
          headers:
            X-Request-Id:
              $ref: "#/components/headers/XRequestId"
            Set-Cookie:
              $ref: "#/components/headers/InvalidateAuthenticationCookies"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ResetPasswordSuccessResponse"
        "404":
          description: >
            The provided verification code or associated user could not be found.  
            This may occur if the code is invalid or the user no longer exists in the system.
          headers:
            X-Request-Id:
              $ref: "#/components/headers/XRequestId"
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: "#/components/schemas/VerificationCodeNotFoundError"
                  - $ref: "#/components/schemas/UserNotFoundError"
        "400":
          description: >
            The password reset request could not be completed due to invalid or expired data.  
            Possible causes include:
            - The verification code has expired or was already consumed.  
            - The new password does not meet security requirements or was previously used.  
            The client should prompt the user to request a new password reset code and try again.
          headers:
            X-Request-Id:
              $ref: "#/components/headers/XRequestId"
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: "#/components/schemas/VerificationCodeExpiredError"
                  - $ref: "#/components/schemas/VerificationCodeConsumedError"
                  - $ref: "#/components/schemas/PasswordReuseNotAllowed"
  /auth/refresh:
    get:
      security:
        - RefreshTokenCokie: []
      tags: [Email & Password Auth]
      summary: Refresh the user's access token using a valid refresh token
      description: >
        Issues a new access token (and optionally a new refresh token) for an authenticated session.  
        The request must include a valid **refresh token** stored in the user's HTTP-only cookie. If the refresh token is valid and the session is still active, a new access token will be returned and authentication cookies will be updated.  
        If the refresh token is expired, invalid, or mismatched, the session will be invalidated and all authentication cookies will be cleared to enforce re-authentication.  
        This endpoint ensures seamless session continuity while maintaining security best practices.
      responses:
        "200":
          description: >
            Access token successfully refreshed.  
            The user's session remains active, and new authentication cookies are set.  
            If a new refresh token was issued, it replaces the previous one automatically.
          headers:
            X-Request-Id:
              $ref: "#/components/headers/XRequestId"
            Set-Cookie:
              $ref: "#/components/headers/AuthenticationCookies"
          content:
            application/json:
              schema:
                $ref: "#/components/schema/RefreshTokenEndpointSuccessResponse"
        "401":
          description: >
            The refresh token is invalid, expired, missing, or does not match the current session.  
            All authentication cookies are invalidated to prevent unauthorized access,  
            and the user must log in again to obtain a new session.  
            This response covers multiple possible authentication-related errors such as invalid token type, missing cookie, or user/session mismatch.
          headers:
            X-Request-Id:
              $ref: "#/components/headers/XRequestId"
            Set-Cookie:
              $ref: "#/components/headers/InvalidateAuthenticationCookies"
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: "#/components/schemas/RefreshTokenInvalidSessionError"
                  - $ref: "#/components/schemas/AuthenticationTokenNotFoundError"
                  - $ref: "#/components/schemas/RefreshTokenTypeError"
                  - $ref: "#/components/schemas/AuthenticationTokenUserNotFoundError"
                  - $ref: "#/components/schemas/RefreshTokenExpiredSessionError"
                  - $ref: "#/components/schemas/AuthenticationTokenSessionMismatchError"
                  - $ref: "#/components/schemas/AuthenticationTokenInvalidTokenErorr"
                  - $ref: "#/components/schemas/AuthenticationTokenExpiredError"
  /auth/logout:
    post:
      security:
        - AccessTokenCokie: []
      tags: [Email & Password Auth]
      summary: Log out the authenticated user and invalidate the current session
      description: >
        Terminates the current authenticated session by invalidating all active authentication tokens and clearing related cookies (`accessToken`, `refreshToken`).  
        This ensures that both the access token and any linked refresh token can no longer be used.  
        The endpoint is typically called when a user explicitly logs out or when a session needs to be forcefully closed for security reasons.  
        Requires a valid access token cookie for authentication and session validation.  
        After a successful logout, the client should remove any cached session state and redirect the user to a login page.
      responses:
        "200":
          description: >
            User successfully logged out.  
            All authentication cookies have been invalidated and removed to ensure session termination.  
            The client should prompt the user to log in again if further access is required.
          headers:
            X-Request-Id:
              $ref: "#/components/headers/XRequestId"
            Set-Cookie:
              $ref: "#/components/headers/InvalidateAuthenticationCookies"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LogoutSuccessResponse"
        "401":
          description: >
            The logout request could not be completed because the provided access token is missing, expired, invalid, or does not correspond to an active user session.  
            In this case, the server cannot confirm the logout and does not modify authentication cookies.  
            The client should treat the user as unauthenticated and clear any local session data.
          headers:
            X-Request-Id:
              $ref: "#/components/headers/XRequestId"
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: "#/components/schemas/AuthenticationTokenNotFoundError"
                  - $ref: "#/components/schemas/AccessTokenTypeError"
                  - $ref: "#/components/schemas/AuthenticationTokenUserNotFoundError"
                  - $ref: "#/components/schemas/AuthenticationTokenInvalidSessionError"
                  - $ref: "#/components/schemas/AuthenticationTokenSessionMismatchError"
                  - $ref: "#/components/schemas/AuthenticationTokenInvalidTokenErorr"
                  - $ref: "#/components/schemas/AuthenticationTokenExpiredError"
components:
  schemas:
    # REUSABLE DATA
    UserData:
      type: object
      required:
        - _id
        - name
        - email
        - isEmailVerified
        - userPreferences
        - createdAt
        - updatedAt
      properties:
        _id:
          type: string
          example: 6904fb216bdaf225b3726294
        name:
          type: string
          example: user
        email:
          type: string
          example: marinescua914@gmail.com
        isEmailVerified:
          type: boolean
          example: false
        userPreferences:
          type: object
          required:
            - enable2FA
            - emailNotification
          properties:
            enable2FA:
              type: boolean
              example: false
          emailNotification:
            type: boolean
            example: true
        createdAt:
          type: string
          format: date-time
          example: 2025-10-31T18:08:33.919Z
        updatedAt:
          type: string
          format: date-time
          example: 2025-10-31T18:08:33.919Z
    ResponseMetadata:
      type: object
      required:
        - timestamp
        - requestId
      properties:
        timestamp:
          type: string
          format: date-time
          example: 2025-10-31T18:08:35.135Z
        requestId:
          type: string
          example: 627c83c6ac314a94bd9348d78
        count:
          type: number
    # REQUEST BODY
    UserRegistrationRequestBody:
      type: object
      required:
        - name
        - email
        - password
        - confirmPassword
      properties:
        name:
          type: string
          description: The user's full name
          minLength: 1
          maxLength: 64
          example: John Doe
        email:
          type: string
          format: email
          minLength: 1
          maxLength: 64
          example: john.doe@example.com
        password:
          type: string
          minLength: 8
          pattern: ^(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*()_\-+=\[\]{}|\\;:\'",.<>/?]).{8,}$
          description: Must start with a capital letter and contain at least one special character
          example: Password@123
        confirmPassword:
          type: string
          minLength: 8
          pattern: ^(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*()_\-+=\[\]{}|\\;:\'",.<>/?]).{8,}$
          description: Must match the password field
          example: Password@123
    UserLoginRequestBody:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          minLength: 1
          maxLength: 64
          example: john.doe@example.com
        password:
          type: string
          minLength: 8
          pattern: ^(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*()_\-+=\[\]{}|\\;:\'",.<>/?]).{8,}$
          description: Must start with a capital letter and contain at least one special character
          example: Password@123
    ForgotPasswordRequestBody:
      type: object
      required:
        - email
      properties:
        email:
          type: string
          format: email
          example: john.doe@gmail.com
    ResetPasswordRequestBody:
      type: object
      required:
        - verificationCode
        - password
      properties:
        verificationCode:
          type: string
          minLength: 1
          maxLength: 64
          example: 8ee6af17747140d8951121739
        password:
          type: string
          minLength: 8
          pattern: ^(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*()_\-+=\[\]{}|\\;:\'",.<>/?]).{8,}$
          description: Must start with a capital letter and contain at least one special character
          example: Password@123
    # RESPONSES
    RegistrationSuccessReponse:
      type: object
      required:
        - success
        - statusCode
        - message
        - data
        - metadata
      properties:
        success:
          type: boolean
          enum: [true]
          example: true
        statusCode:
          type: integer
          enum: [201]
          example: 201
        message:
          type: string
          example: Registration successful. A verification email has been sent to your email address.
        data:
          type: object
          properties:
            user:
              $ref: "#/components/schemas/UserData"
            isVerificationEmailSend:
              type: boolean
              example: true
            nextStep:
              type: string
              enum: ["CONFIRM_SIGN_UP"]
              example: CONFIRM_SIGN_UP
            metadata:
              $ref: "#/components/schemas/ResponseMetadata"
    LoginEmailVerificationPendingResponse:
      type: object
      required:
        - success
        - statusCode
        - message
        - data
        - metadata
      properties:
        success:
          type: boolean
          enum: [true]
          example: true
        statusCode:
          type: integer
          enum: [200]
          example: 200
        message:
          type: string
          example: Authentication pending, your email address has not yet been verified. Please confirm your email to proceed.
        data:
          type: object
          properties:
            nextStep:
              type: string
              enum: ["CONFIRM_SIGN_UP"]
              example: CONFIRM_SIGN_UP
          metadata:
            $ref: "#/components/schemas/ResponseMetadata"
    LoginSuccessResponse:
      type: object
      required:
        - success
        - statusCode
        - message
        - data
        - metadata
      properties:
        success:
          type: boolean
          enum: [true]
          example: true
        statusCode:
          type: integer
          enum: [200]
          example: 200
        message:
          type: string
          example: Authentication successful, You have been signed in successfully.
        data:
          type: object
          required:
            - mfaRequired
            - nextStep
            - user
          properties:
            user:
              $ref: "#/components/schema/UserData"
            nextStep:
              type: string
              enum: ["OK"]
              example: OK
            mfaRequired:
              type: boolean
              enum: [false]
              example: false
          metadata:
            $ref: "#/components/schemas/ResponseMetadata"
    MFAPendingResponse:
      type: object
      required:
        - success
        - statusCode
        - message
        - data
        - metadata
      properties:
        success:
          type: boolean
          enum: [true]
          example: true
        statusCode:
          type: integer
          enum: [200]
          example: 200
        message:
          type: string
          example: Two-factor authentication required. Please enter your verification code to complete this process.
        data:
          type: object
          required:
            - mfaRequired
            - nextStep
          properties:
            nextStep:
              type: string
              enum: ["MFA_REQUIRED"]
              example: MFA_REQUIRED
            mfaRequired:
              type: boolean
              enum: [true]
              example: true
          metadata:
            $ref: "#/components/schemas/ResponseMetadata"
    EmailConfirmedSuccessResponse:
      type: object
      required:
        - success
        - statusCode
        - message
        - data
        - metadata
      properties:
        success:
          type: boolean
          enum: [true]
          example: true
        statusCode:
          type: integer
          enum: [200]
          example: 200
        message:
          type: string
          example: Email address successfully verified. You can now proceed to login.
        data:
          type: object
          required:
            - nextStep
          properties:
            nextStep:
              type: string
              enum: ["CONFIRMED_EMAIL_RETURN_TO_LOGIN"]
              example: CONFIRMED_EMAIL_RETURN_TO_LOGIN
          metadata:
            $ref: "#/components/schemas/ResponseMetadata"
    ForgotPasswordSuccessResponse:
      type: object
      required:
        - success
        - statusCode
        - message
        - data
        - metadata
      properties:
        success:
          type: boolean
          enum: [true]
          example: true
        statusCode:
          type: integer
          enum: [200]
          example: 200
        message:
          type: string
          example: Password reset request successfully processed. Please check your email for further instructions.
        data:
          type: object
          required:
            - nextStep
            - mfaRequired
          properties:
            nextStep:
              type: string
              enum: ["OK"]
              example: OK
            mfaRequired:
              type: boolean
              enum: [false]
              example: false
          metadata:
            $ref: "#/components/schemas/ResponseMetadata"
    ResetPasswordSuccessResponse:
      type: object
      required:
        - success
        - statusCode
        - message
        - data
        - metadata
      properties:
        success:
          type: boolean
          enum: [true]
          example: true
        statusCode:
          type: integer
          enum: [200]
          example: 200
        message:
          type: string
          example: Password reset completed. If you didn’t request this change, please contact support immediately.
        data:
          type: object
          required:
            - nextStep
          properties:
            nextStep:
              type: string
              enum: ["OK"]
              example: OK
          metadata:
            $ref: "#/components/schemas/ResponseMetadata"
    RefreshTokenEndpointSuccessResponse:
      type: object
      required:
        - success
        - statusCode
        - message
        - data
        - metadata
      properties:
        success:
          type: boolean
          enum: [true]
          example: true
        statusCode:
          type: integer
          enum: [200]
          example: 200
        message:
          type: string
          example: Access token successfully refreshed. Your session remains active.
        data:
          type: object
          required:
            - nextStep
          properties:
            nextStep:
              type: string
              enum: ["OK"]
              example: OK
          metadata:
            $ref: "#/components/schemas/ResponseMetadata"
    LogoutSuccessResponse:
      type: object
      required:
        - success
        - statusCode
        - message
        - data
        - metadata
      properties:
        success:
          type: boolean
          enum: [true]
          example: true
        statusCode:
          type: integer
          enum: [200]
          example: 200
        message:
          type: string
          example: Logout successful, you have been securely signed out.
        data:
          type: object
          required:
            - nextStep
          properties:
            nextStep:
              type: string
              enum: ["LOGOUT"]
              example: LOGOUT
          metadata:
            $ref: "#/components/schemas/ResponseMetadata"
    # ERRORS
    # GENERAL ERRORS
    InternalServerError:
      type: object
      required:
        - success
        - message
        - errorCode
        - requestId
      properties:
        success:
          type: boolean
          enum: [false]
          example: false
        message:
          type: string
          example: Internal Server Error
        errorCode:
          type: string
          enum: ["INTERNAL_SERVER_ERROR"]
          example: INTERNAL_SERVER_ERROR
        requestId:
          type: string
          example: cc5065df0c6b4c19970d4e92f
    ForbiddenError:
      type: object
      required:
        - success
        - message
        - errorCode
        - requestId
      properties:
        success:
          type: boolean
          enum: [false]
          example: false
        message:
          type: string
          example: Access denied, you do not have permission to perform this action.
        errorCode:
          type: string
          enum: ["ACCESS_FORBIDDEN"]
          example: ACCESS_FORBIDDEN
        requestId:
          type: string
          example: cc5065df0c6b4c19970d4e92f
    TooManyRequestsError:
      type: object
      required:
        - success
        - message
        - errorCode
        - requestId
      properties:
        success:
          type: boolean
          enum: [false]
          example: false
        message:
          type: string
          example: Too many requests. Please try again later.
        errorCode:
          type: string
          enum: ["TOO_MANY_REQUESTS"]
          example: TOO_MANY_REQUESTS
        requestId:
          type: string
          example: cc5065df0c6b4c19970d4e92f
    EmailServiceError:
      type: object
      required:
        - success
        - message
        - errorCode
        - requestId
      properties:
        success:
          type: boolean
          enum: [false]
          example: false
        message:
          type: string
          example: Failed to send the email. Please try again later.
        errorCode:
          type: string
          enum: ["EMAIL_SERVICE_ERROR"]
          example: EMAIL_SERVICE_ERROR
        requestId:
          type: string
          example: cc5065df0c6b4c19970d4e92f
    InvalidRequestBodyValidationError:
      type: object
      required:
        - success
        - message
        - errorCode
        - requestId
        - errors
      properties:
        success:
          type: boolean
          enum: [false]
          example: false
        message:
          type: string
          example: Validation failed, some fields in the request body did not meet the expected format or constraints.
        errorCode:
          type: string
          enum: ["VALIDATION_ERROR_INVALID_REQUEST_BODY"]
          example: VALIDATION_ERROR_INVALID_REQUEST_BODY
        requestId:
          type: string
          example: cc5065df0c6b4c19970d4e92f
        errors:
          type: array
          minItems: 1
          items:
            type: object
            required:
              - field
              - message
            properties:
              field:
                type: string
              message:
                type: string
          example:
            - field: email
              message: Invalid email address
            - field: password
              message: Password must be at least 8 characters
    # EMAIL & PASS ERRORS
    EmailAlreadyExistsError:
      type: object
      required:
        - success
        - message
        - errorCode
        - requestId
      properties:
        success:
          type: boolean
          enum: [false]
          example: false
        message:
          type: string
          example: Registration failed, this email address is already associated with an existing account.
        errorCode:
          type: string
          enum: ["AUTH_EMAIL_ALREADY_EXISTS"]
          example: AUTH_EMAIL_ALREADY_EXISTS
        requestId:
          type: string
          example: cc5065df0c6b4c19970d4e92f
    UserNotFoundError:
      type: object
      required:
        - success
        - message
        - errorCode
        - requestId
      properties:
        success:
          type: boolean
          enum: [false]
          example: false
        message:
          type: string
          example: User with the specified email was not found.
        errorCode:
          type: string
          enum: ["AUTH_USER_NOT_FOUND"]
          example: AUTH_USER_NOT_FOUND
        requestId:
          type: string
          example: cc5065df0c6b4c19970d4e92f
    InvalidCredentialsError:
      type: object
      required:
        - success
        - message
        - errorCode
        - requestId
      properties:
        success:
          type: boolean
          enum: [false]
          example: false
        message:
          type: string
          example: Invalid credentials. Please check your email and password and try again.
        errorCode:
          type: string
          enum: ["AUTH_INVALID_CREDENTIALS"]
          example: AUTH_INVALID_CREDENTIALS
        requestId:
          type: string
          example: cc5065df0c6b4c19970d4e92f
    PasswordReuseNotAllowed:
      type: object
      required:
        - success
        - message
        - errorCode
        - requestId
      properties:
        success:
          type: boolean
          enum: [false]
          example: false
        message:
          type: string
          example: You cannot reuse a previous password. Please choose a new one.
        errorCode:
          type: string
          enum: ["AUTH_PASSWORD_REUSE_NOT_ALLOWED"]
          example: AUTH_PASSWORD_REUSE_NOT_ALLOWED
        requestId:
          type: string
          example: cc5065df0c6b4c19970d4e92f
    # VERFICATION CODES
    VerificationCodeNotFoundError:
      type: object
      required:
        - success
        - message
        - errorCode
        - requestId
      properties:
        success:
          type: boolean
          enum: [false]
          example: false
        message:
          type: string
          example: Invalid or non-existent verification code. Please request a new one.
        errorCode:
          type: string
          enum: ["VERIFICATION_CODE_ERROR_CODE_NOT_FOUND"]
          example: VERIFICATION_CODE_ERROR_CODE_NOT_FOUND
        requestId:
          type: string
          example: cc5065df0c6b4c19970d4e92f
    VerificationCodeExpiredError:
      type: object
      required:
        - success
        - message
        - errorCode
        - requestId
      properties:
        success:
          type: boolean
          enum: [false]
          example: false
        message:
          type: string
          example: This verification code has expired. Please request a new one to continue.
        errorCode:
          type: string
          enum: ["VERIFICATION_CODE_ERROR_CODE_EXPIRED"]
          example: VERIFICATION_CODE_ERROR_CODE_EXPIRED
        requestId:
          type: string
          example: cc5065df0c6b4c19970d4e92f
    VerificationCodeConsumedError:
      type: object
      required:
        - success
        - message
        - errorCode
        - requestId
      properties:
        success:
          type: boolean
          enum: [false]
          example: false
        message:
          type: string
          example: This verification code has already been used. Please request a new one if needed.
        errorCode:
          type: string
          enum: ["VERIFICATION_CODE_ERROR_CODE_CONSUMED"]
          example: VERIFICATION_CODE_ERROR_CODE_CONSUMED
        requestId:
          type: string
          example: cc5065df0c6b4c19970d4e92f
    # TOKEN GENERAL ERRORS
    AuthenticationTokenNotFoundError:
      type: object
      required:
        - success
        - message
        - errorCode
        - requestId
      properties:
        success:
          type: boolean
          enum: [false]
          example: false
        message:
          type: string
          example: Authentication failed, no authentication token provided.
        errorCode:
          type: string
          enum: ["AUTH_TOKEN_NOT_FOUND"]
          example: AUTH_TOKEN_NOT_FOUND
        requestId:
          type: string
          example: cc5065df0c6b4c19970d4e92f
    AuthenticationTokenUserNotFoundError:
      type: object
      required:
        - success
        - message
        - errorCode
        - requestId
      properties:
        success:
          type: boolean
          enum: [false]
          example: false
        message:
          type: string
          example: Authentication failed, the user associated with this token does not exist.
        errorCode:
          type: string
          enum: ["AUTH_TOKEN_USER_NOT_FOUND"]
          example: AUTH_TOKEN_USER_NOT_FOUND
        requestId:
          type: string
          example: cc5065df0c6b4c19970d4e92f
    AuthenticationTokenInvalidSessionError:
      type: object
      required:
        - success
        - message
        - errorCode
        - requestId
      properties:
        success:
          type: boolean
          enum: [false]
          example: false
        message:
          type: string
          example: Authentication failed, the token session is invalid, expired, or has already been consumed.
        errorCode:
          type: string
          enum: ["AUTH_TOKEN_SESSION_INVALID"]
          example: AUTH_TOKEN_SESSION_INVALID
        requestId:
          type: string
          example: cc5065df0c6b4c19970d4e92f
    AuthenticationTokenSessionMismatchError:
      type: object
      required:
        - success
        - message
        - errorCode
        - requestId
      properties:
        success:
          type: boolean
          enum: [false]
          example: false
        message:
          type: string
          example: Authentication failed, the user ID in the MFA token does not match the user ID of the session.
        errorCode:
          type: string
          enum: ["AUTH_TOKEN_SESSION_MISMATCH"]
          example: AUTH_TOKEN_SESSION_MISMATCH
        requestId:
          type: string
          example: cc5065df0c6b4c19970d4e92f
    AuthenticationTokenInvalidTokenErorr:
      type: object
      required:
        - success
        - message
        - errorCode
        - requestId
      properties:
        success:
          type: boolean
          enum: [false]
        message:
          type: string
        errorCode:
          type: string
          enum: ["AUTH_TOKEN_INVALID"]
        requestId:
          type: string
      examples:
        jwtMalformed:
          summary: Token is malformed
          value:
            success: false
            message: "Authentication failed: jwt malformed"
            errorCode: AUTH_TOKEN_INVALID
            requestId: cc5065df0c6b4c19970d4e92f
        invalidSignature:
          summary: Token signature is invalid
          value:
            success: false
            message: "Authentication failed: invalid signature"
            errorCode: AUTH_TOKEN_INVALID
            requestId: cc5065df0c6b4c19970d4e92f
        tokenMissing:
          summary: Token is missing
          value:
            success: false
            message: "Authentication failed: jwt must be provided"
            errorCode: AUTH_TOKEN_INVALID
            requestId: cc5065df0c6b4c19970d4e92f
        invalidAudience:
          summary: Token audience does not match
          value:
            success: false
            message: "Authentication failed: invalid audience"
            errorCode: AUTH_TOKEN_INVALID
            requestId: cc5065df0c6b4c19970d4e92f
        invalidIssuer:
          summary: Token issuer is invalid
          value:
            success: false
            message: "Authentication failed: invalid issuer"
            errorCode: AUTH_TOKEN_INVALID
            requestId: cc5065df0c6b4c19970d4e92f
    AuthenticationTokenExpiredError:
      type: object
      required:
        - success
        - message
        - errorCode
        - requestId
      properties:
        success:
          type: boolean
          enum: [false]
          example: false
        message:
          type: string
          example: Authentication failed, jwt expired at 2025-11-02T18:00:00Z.
        errorCode:
          type: string
          enum: ["AUTH_TOKEN_EXPIRED"]
          example: AUTH_TOKEN_EXPIRED
        requestId:
          type: string
          example: cc5065df0c6b4c19970d4e92f
    # ACCESS TOKEN
    AccessTokenTypeError:
      type: object
      required:
        - success
        - message
        - errorCode
        - requestId
      properties:
        success:
          type: boolean
          enum: [false]
          example: false
        message:
          type: string
          example: Authentication failed, expected an ACCESS token, but received a token of a different type.
        errorCode:
          type: string
          enum: ["AUTH_ACCESS_TOKEN_TYPE_INVALID"]
          example: AUTH_ACCESS_TOKEN_TYPE_INVALID
        requestId:
          type: string
          example: cc5065df0c6b4c19970d4e92f
    # MFA TOKEN
    MFATokenTypeError:
      type: object
      required:
        - success
        - message
        - errorCode
        - requestId
      properties:
        success:
          type: boolean
          enum: [false]
          example: false
        message:
          type: string
          example: Authentication failed, expected an MFA token, but received a token of a different type.
        errorCode:
          type: string
          enum: ["AUTH_MFA_TOKEN_TYPE_INVALID"]
          example: AUTH_MFA_TOKEN_TYPE_INVALID
        requestId:
          type: string
          example: cc5065df0c6b4c19970d4e92f
    MFATokenInvalidEndpointError:
      type: object
      required:
        - success
        - message
        - errorCode
        - requestId
      properties:
        success:
          type: boolean
          enum: [false]
          example: false
        message:
          type: string
          example: Authentication failed, MFA token was sent to an invalid or unsupported endpoint.
        errorCode:
          type: string
          enum: ["AUTH_MFA_INVALID_ENDPOINT"]
          example: AUTH_MFA_INVALID_ENDPOINT
        requestId:
          type: string
          example: cc5065df0c6b4c19970d4e92f
    MFATokenInvalidTokenPurposeError:
      type: object
      required:
        - success
        - message
        - errorCode
        - requestId
      properties:
        success:
          type: boolean
          enum: [false]
          example: false
        message:
          type: string
          example: Authentication failed, MFA token purpose mismatch. Expected 'login', got 'forgot_password'.
        errorCode:
          type: string
          enum: ["AUTH_TOKEN_INVALID_TYPE"]
          example: AUTH_TOKEN_INVALID_TYPE
        requestId:
          type: string
          example: cc5065df0c6b4c19970d4e92f
    # MAGIC LINK TOKEN
    MagicLinkTokenTypeError:
      type: object
      required:
        - success
        - message
        - errorCode
        - requestId
      properties:
        success:
          type: boolean
          enum: [false]
          example: false
        message:
          type: string
          example: Authentication failed, expected an MAGIC-LINK token, but received a token of a different type.
        errorCode:
          type: string
          enum: ["AUTH_MAGIC_LINK_TOKEN_TYPE_INVALID"]
          example: AUTH_MAGIC_LINK_TOKEN_TYPE_INVALID
        requestId:
          type: string
          example: cc5065df0c6b4c19970d4e92f
    # REFRESH TOKEN
    RefreshTokenTypeError:
      type: object
      required:
        - success
        - message
        - errorCode
        - requestId
      properties:
        success:
          type: boolean
          enum: [false]
          example: false
        message:
          type: string
          example: Authentication failed, expected an REFRESH token, but received a token of a different type.
        errorCode:
          type: string
          enum: ["AUTH_REFRESH_TOKEN_TYPE_INVALID"]
          example: AUTH_REFRESH_TOKEN_TYPE_INVALID
        requestId:
          type: string
          example: cc5065df0c6b4c19970d4e92f
    RefreshTokenInvalidSessionError:
      type: object
      required:
        - success
        - message
        - errorCode
        - requestId
      properties:
        success:
          type: boolean
          enum: [false]
          example: false
        message:
          type: string
          example: Authentication failed, the refresh token session does not exist or is invalid. Please log in again.
        errorCode:
          type: string
          enum: ["AUTH_REFRESH_TOKEN_SESSION_INVALID"]
          example: AUTH_REFRESH_TOKEN_SESSION_INVALID
        requestId:
          type: string
          example: cc5065df0c6b4c19970d4e92f
    RefreshTokenExpiredSessionError:
      type: object
      required:
        - success
        - message
        - errorCode
        - requestId
      properties:
        success:
          type: boolean
          enum: [false]
          example: false
        message:
          type: string
          example: Authentication failed, the refresh token session has expired. Please log in again to obtain a new refresh token.
        errorCode:
          type: string
          enum: ["AUTH_REFRESH_TOKEN_SESSION_EXPIRED"]
          example: AUTH_REFRESH_TOKEN_SESSION_EXPIRED
        requestId:
          type: string
          example: cc5065df0c6b4c19970d4e92f
    # MFA
    MfaAlreadyEnabledError:
      type: object
      required:
        - success
        - message
        - errorCode
        - requestId
      properties:
        success:
          type: boolean
          enum: [false]
          example: false
        message:
          type: string
          example: Two-factor authentication is already enabled. No further action is required.
        errorCode:
          type: string
          enum: ["MFA_ALREADY_ENABLED"]
          example: MFA_ALREADY_ENABLED
        requestId:
          type: string
          example: cc5065df0c6b4c19970d4e92f
    MfaAlreadyDisabledError:
      type: object
      required:
        - success
        - message
        - errorCode
        - requestId
      properties:
        success:
          type: boolean
          enum: [false]
          example: false
        message:
          type: string
          example: Two-factor authentication is already disabled. No further action is required.
        errorCode:
          type: string
          enum: ["MFA_ALREADY_DISABLED"]
          example: MFA_ALREADY_DISABLED
        requestId:
          type: string
          example: cc5065df0c6b4c19970d4e92f
    MfaTemporarySecretExpiredError:
      type: object
      required:
        - success
        - message
        - errorCode
        - requestId
      properties:
        success:
          type: boolean
          enum: [false]
          example: false
        message:
          type: string
          example: Temporary TOTP secret expired. Please generate a new QR code to configure 2FA.
        errorCode:
          type: string
          enum: ["MFA_EXPIRED_TEMP_SECRET"]
          example: MFA_EXPIRED_TEMP_SECRET
        requestId:
          type: string
          example: cc5065df0c6b4c19970d4e92f
    MfaInvalidverificationCodeError:
      type: object
      required:
        - success
        - message
        - errorCode
        - requestId
      properties:
        success:
          type: boolean
          enum: [false]
          example: false
        message:
          type: string
          example: The MFA code you entered is incorrect or has expired. Please request a new code to complete the verification.
        errorCode:
          type: string
          enum: ["MFA_INVALID_VERIFICATION_CODE"]
          example: MFA_INVALID_VERIFICATION_CODE
        requestId:
          type: string
          example: cc5065df0c6b4c19970d4e92f
    MfaNotEnabledError:
      type: object
      required:
        - success
        - message
        - errorCode
        - requestId
      properties:
        success:
          type: boolean
          enum: [false]
          example: false
        message:
          type: string
          example: Cannot verify MFA because two-factor authentication is not enabled for this account.
        errorCode:
          type: string
          enum: ["MFA_NOT_ENABLED"]
          example: MFA_NOT_ENABLED
        requestId:
          type: string
          example: cc5065df0c6b4c19970d4e92f
    InvalidBackupCodeError:
      type: object
      required:
        - success
        - message
        - errorCode
        - requestId
      properties:
        success:
          type: boolean
          enum: [false]
          example: false
        message:
          type: string
          example: The backup code you entered is invalid or has already been used. Please try a different one.
        errorCode:
          type: string
          enum: ["BACKUPCODE_INVALID_CODE"]
          example: BACKUPCODE_INVALID_CODE
        requestId:
          type: string
          example: cc5065df0c6b4c19970d4e92f
    # OIDC
    OIDCSessionNotFoundError:
      type: object
      required:
        - success
        - message
        - errorCode
        - requestId
      properties:
        success:
          type: boolean
          enum: [false]
          example: false
        message:
          type: string
          example: Authentication failed, no valid OIDC session was found for the given state and provider.
        errorCode:
          type: string
          enum: ["OIDC_SESSION_NOT_FOUND"]
          example: OIDC_SESSION_NOT_FOUND
        requestId:
          type: string
          example: cc5065df0c6b4c19970d4e92f
    OIDCSessionExpiredError:
      type: object
      required:
        - success
        - message
        - errorCode
        - requestId
      properties:
        success:
          type: boolean
          enum: [false]
          example: false
        message:
          type: string
          example: Authentication failed, the OIDC session has expired. Please restart the sign-in process.
        errorCode:
          type: string
          enum: ["OIDC_SESSION_CONSUMED"]
          example: OIDC_SESSION_CONSUMED
        requestId:
          type: string
          example: cc5065df0c6b4c19970d4e92f
    OIDCSessionConsumedError:
      type: object
      required:
        - success
        - message
        - errorCode
        - requestId
      properties:
        success:
          type: boolean
          enum: [false]
          example: false
        message:
          type: string
          example: Authentication failed, the OIDC session has already been used and cannot be reused.
        errorCode:
          type: string
          enum: ["OIDC_SESSION_CONSUMED"]
          example: OIDC_SESSION_CONSUMED
        requestId:
          type: string
          example: cc5065df0c6b4c19970d4e92f
    OIDCFailedAuthenticationError:
      type: object
      required:
        - success
        - message
        - errorCode
        - requestId
      properties:
        success:
          type: boolean
          enum: [false]
          example: false
        message:
          type: string
          example: Authentication failed while communicating with the external identity provider. Please try again or use a different sign-in method.
        errorCode:
          type: string
          enum: ["OIDC_FAILED_AUTHENTIFICATION"]
          example: OIDC_FAILED_AUTHENTIFICATION
        requestId:
          type: string
          example: cc5065df0c6b4c19970d4e92f
    # PASSKEY
    PasskeyChallengeSessionNotFoundError:
      type: object
      required:
        - success
        - message
        - errorCode
        - requestId
      properties:
        success:
          type: boolean
          enum: [false]
          example: false
        message:
          type: string
          example: Authentication failed, the passkey registration session was not found or is invalid. Please restart the passkey process.
        errorCode:
          type: string
          enum: ["PASSKEY_CHALLENGE_SESSION_INVALID"]
          example: PASSKEY_CHALLENGE_SESSION_INVALID
        requestId:
          type: string
          example: cc5065df0c6b4c19970d4e92f
    PasskeyChallengeSessionConsumedError:
      type: object
      required:
        - success
        - message
        - errorCode
        - requestId
      properties:
        success:
          type: boolean
          enum: [false]
          example: false
        message:
          type: string
          example: Authentication failed, the passkey session has already been used. Please restart the passkey process.
        errorCode:
          type: string
          enum: ["PASSKEY_CHALLENGE_SESSION_CONSUMED"]
          example: PASSKEY_CHALLENGE_SESSION_CONSUMED
        requestId:
          type: string
          example: cc5065df0c6b4c19970d4e92f
    PasskeyChallengeSessionInvalidPurposeError:
      type: object
      required:
        - success
        - message
        - errorCode
        - requestId
      properties:
        success:
          type: boolean
          enum: [false]
          example: false
        message:
          type: string
          example: Authentication failed, the passkey session purpose does not match the expected type. Please restart the passkey process.
        errorCode:
          type: string
          enum: ["PASSKEY_CHALLENGE_SESSION__INVALID_PURPOSE"]
          example: PASSKEY_CHALLENGE_SESSION__INVALID_PURPOSE
        requestId:
          type: string
          example: cc5065df0c6b4c19970d4e92f
    PasskeyChallengeSessionExpiredError:
      type: object
      required:
        - success
        - message
        - errorCode
        - requestId
      properties:
        success:
          type: boolean
          enum: [false]
          example: false
        message:
          type: string
          example: Authentication failed, the passkey session has expired. Please restart the passkey process.
        errorCode:
          type: string
          enum: ["PASSKEY_CHALLENGE_SESSION__EXPIRED"]
          example: PASSKEY_CHALLENGE_SESSION__EXPIRED
        requestId:
          type: string
          example: cc5065df0c6b4c19970d4e92f
    PasskeyChallengeVerificationError:
      type: object
      required:
        - success
        - message
        - errorCode
        - requestId
      properties:
        success:
          type: boolean
          enum: [false]
          example: false
        message:
          type: string
          example: Authentication failed, the passkey verification could not be completed successfully. Please ensure you are using the correct passkey and try again.
        errorCode:
          type: string
          enum: ["PASSKEY_CHALENGE_VERIFICATION_ERROR"]
          example: PASSKEY_CHALENGE_VERIFICATION_ERROR
        requestId:
          type: string
          example: cc5065df0c6b4c19970d4e92f
    PasskeyNotFoundError:
      type: object
      required:
        - success
        - message
        - errorCode
        - requestId
      properties:
        success:
          type: boolean
          enum: [false]
          example: false
        message:
          type: string
          example: Authentication failed, the provided passkey could not be found or is invalid. Please remove this passkey from your device and register a new one.
        errorCode:
          type: string
          enum: ["PASSKEY_NOT_FOUND"]
          example: PASSKEY_NOT_FOUND
        requestId:
          type: string
          example: cc5065df0c6b4c19970d4e92f
    # SESSIONS
    UserSessionNotFoundError:
      type: object
      required:
        - success
        - message
        - errorCode
        - requestId
      properties:
        success:
          type: boolean
          enum: [false]
          example: false
        message:
          type: string
          example: The session associated with this operation could not be found.
        errorCode:
          type: string
          enum: ["AUTH_SESSION_NOT_FOUND"]
          example: AUTH_SESSION_NOT_FOUND
        requestId:
          type: string
          example: cc5065df0c6b4c19970d4e92f
  # HEADERS
  headers:
    XRequestId:
      description: Unique request identifier for tracing and debugging
      schema:
        type: string
        example: 627c83c6ac314a94bd9348d78
    AuthenticationCookies:
      description: |
        Multiple cookies may be set in this response:
        1. accessToken — HTTP-only access token
        2. refreshToken — HTTP-only refresh token
        3. mfaToken — HTTP-only MFA token (if required)
      schema:
        type: string
      example: |
        accessToken=eyJhbGciOi...; Path=/; HttpOnly; Secure; SameSite=Strict; Expires=Wed, 03 Nov 2025 20:00:00 GMT,
        refreshToken=eyJhbGciOi...; Path=/auth/refresh; HttpOnly; Secure; SameSite=Strict; Expires=Wed, 03 Nov 2025 20:00:00 GMT
        mfaToken=eyJhbGciOi...; Path=/mfa; HttpOnly; Secure; SameSite=Strict; Expires=Wed, 03 Nov 2025 20:00:00 GMT
    MFATokenCookie:
      description: |
        HTTP-only MFA token cookie used for two-factor authentication.
        This cookie must be included in subsequent requests to complete the MFA step.
      schema:
        type: string
      example: |
        mfaToken=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...; Path=/mfa; HttpOnly; Secure; SameSite=Strict; Expires=Wed, 03 Nov 2025 20:00:00 GMT
    InvalidateAuthenticationCookies:
      description: |
        Multiple authentication cookies may be cleared in this response to invalidate any existing sessions.
        This ensures that previously issued tokens become unusable and the user must log in again.
        The following cookies are invalidated:
        1. accessToken — HTTP-only access token
        2. refreshToken — HTTP-only refresh token
      schema:
        type: string
      example: |
        accessToken=; Path=/; HttpOnly; Secure; SameSite=Strict; Expires=Thu, 01 Jan 1970 00:00:00 GMT
        refreshToken=; Path=/auth/refresh; HttpOnly; Secure; SameSite=Strict; Expires=Thu, 01 Jan 1970 00:00:00 GMT
  # SECURITY
  securitySchemes:
    AccessTokenCokie:
      type: apiKey
      in: cookie
      name: accessToken
    RefreshTokenCokie:
      type: apiKey
      in: cookie
      name: accessToken
